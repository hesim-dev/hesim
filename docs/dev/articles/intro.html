<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to `hesim` • hesim</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to `hesim`">
<meta property="og:description" content="hesim">
<meta property="og:image" content="https://hesim-dev.github.io/hesim/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-131661920-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-131661920-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hesim</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.4.2.9999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">API</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction to hesim</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Cohort discrete time state transition models</li>
    <li>
      <a href="../articles/markov-cohort.html">Simple Markov cohort model</a>
    </li>
    <li>
      <a href="../articles/markov-inhomogeneous-cohort.html">Time inhomogeneous Markov cohort models</a>
    </li>
    <li>
      <a href="../articles/mlogit.html">Markov models with multinomial logistic regression</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Individual continuous time state transition models</li>
    <li>
      <a href="../articles/markov-inhomogeneous-indiv.html">Time inhomogeneous Markov individual-level models</a>
    </li>
    <li>
      <a href="../articles/mstate.html">Markov and semi-Markov multi-state models</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Partitioned survival analysis</li>
    <li>
      <a href="../articles/psm.html">N-state partitioned survival models</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Decision analysis</li>
    <li>
      <a href="../articles/cea.html">Cost-effectiveness analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/benchmarks.html">Benchmarks</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hesim-dev/hesim/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="intro_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="intro_files/kePrint-0.0.1/kePrint.js"></script><link href="intro_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to <code>hesim</code>
</h1>
            
            <h4 class="date">2021-02-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hesim-dev/hesim/blob/master/vignettes/intro.Rmd"><code>vignettes/intro.Rmd</code></a></small>
      <div class="hidden name"><code>intro.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>This article provides an overview of the <code>hesim</code> package and a quick example. The other articles provide more in depth examples.</p>
<p><code>hesim</code> supports three types of health-economic models: (i) cohort discrete time state transition models (cDTSTMs), (ii) N-state partitioned survival models (PSMs), and (iii) individual-level continuous time state transition models (iCTSTMs). cDTSTMs are Markov cohort models and can be time-homogeneous or time-inhomogeneous. iCTSTMs are individual-level simulations that can encompass both Markov and semi-Markov processes. All models are implemented as <a href="https://r6.r-lib.org/index.html">R6</a> classes and have methods for simulating disease progression, QALYs, and costs.</p>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
Economic model
</th>
<th style="text-align:left;">
R6 class
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
N-state partitioned survival model (PSM)
</td>
<td style="text-align:left;">
<code><a href="../reference/Psm.html">hesim::Psm</a></code>
</td>
</tr>
<tr>
<td style="text-align:left;">
Cohort discrete time state transition model (cDTSTM)
</td>
<td style="text-align:left;">
<code><a href="../reference/CohortDtstm.html">hesim::CohortDtstm</a></code>
</td>
</tr>
<tr>
<td style="text-align:left;">
Individual-level continuous time state transition model (iCTSTM)
</td>
<td style="text-align:left;">
<code><a href="../reference/IndivCtstm.html">hesim::IndivCtstm</a></code>
</td>
</tr>
</tbody>
</table>
<p>Each economic model consists of submodels for disease progression, utility, and costs (usually for multiple cost categories). As shown in the figure, a typical analysis proceeds in a 3-steps:</p>
<p><br><img src="econ-eval-process-hesim.png" width="600px"><br><br></p>
<ol style="list-style-type: decimal">
<li>
<strong>Parameterization</strong>: An economic model is parameterized by estimating statistical models for disease progression, utilities, and costs using “estimation” datasets, such as individual patient data (IPD) from a single study or aggregate data from multiple studies.</li>
<li>
<strong>Simulation</strong>: The statistical models estimated in Step 1 are combined to construct an economic model. For a given model structure, disease progression, QALYs, and costs are simulated from “input data”, based on the target population and treatment strategies of interest.</li>
<li>
<strong>Decision analysis</strong>: Simulated outcomes from Step 2 are used to perform decision analysis using approaches such as <a href="https://en.wikipedia.org/wiki/Cost-effectiveness_analysis">cost-effectiveness analysis (CEA)</a> and <a href="https://en.wikipedia.org/wiki/Multiple-criteria_decision_analysis">multi-criteria decision analysis (MCDA)</a>, although only CEA is currently supported.</li>
</ol>
<p>The entire analysis is inherently Bayesian, as uncertainty in the parameters from the statistical models is propagated throughout the economic model and decision analysis with probabilistic sensitivity analysis (PSA). Furthermore, since the statistical and economic models are integrated, patient heterogeneity can be easily introduced with patient level covariates.</p>
</div>
<div id="treatment-strategies-target-population-and-model-structure" class="section level1">
<h1 class="hasAnchor">
<a href="#treatment-strategies-target-population-and-model-structure" class="anchor"></a>Treatment strategies, target population, and model structure</h1>
<p>Before beginning an analysis, it is necessary to define the treatment strategies of interest, the target population, and the model structure. This can be done in <code>hesim</code> by creating a <code>hesim_data</code> object with the function <code><a href="../reference/hesim_data.html">hesim_data()</a></code>. Integer valued identification (ID) variables are used to uniquely identify strategies (<code>strategy_id</code>), patients (<code>patient_id</code>), non-death health-states (<code>state_id</code>), and (if applicable) health-state transitions (<code>transition_id</code>). Subgroups can optionally be identified with <code>grp_id</code>.</p>
<p>Let’s consider an example where we use an iCTSTM to evaluate two competing treatment strategies, the <em>standard of care (SOC)</em> and a <em>New</em> treatment. We will consider a generic model of disease progression with three health states (<em>stage 1</em>, <em>stage 2</em>, and <em>death</em>) with four transitions (<em>stage 1 -&gt; stage 2</em>, <em>stage 2 -&gt; stage 1</em>, <em>stage 1 -&gt; death</em>, and <em>stage 2 -&gt; death</em>). Since we are using an individual-level model, we must simulate a target population that is sufficiently large so that uncertainty reflects uncertainty in the model parameters, rather than variability across simulated individuals. For the sake of illustration, we will create subgroups stratified by sex.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://hesim-dev.github.io/hesim/">"hesim"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://Rdatatable.gitlab.io/data.table">"data.table"</a></span><span class="op">)</span>

<span class="co"># Treatment strategies</span>
<span class="va">strategies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>strategy_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,
                         strategy_name  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SOC"</span>, <span class="st">"New"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Patients</span>
<span class="va">n_patients</span> <span class="op">&lt;-</span> <span class="fl">1000</span>
<span class="va">patients</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>patient_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_patients</span>,
                       age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n_patients</span>, mean <span class="op">=</span> <span class="fl">45</span>, sd <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,
                       female <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n_patients</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">.51</span><span class="op">)</span><span class="op">)</span>
<span class="va">patients</span><span class="op">[</span>, <span class="va">grp_id</span> <span class="op">:=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">female</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span>
<span class="va">patients</span><span class="op">[</span>, <span class="va">grp_name</span> <span class="op">:=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">ifelse</a></span><span class="op">(</span><span class="va">female</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"Female"</span>, <span class="st">"Male"</span><span class="op">)</span><span class="op">]</span>

<span class="co"># (Non-death) health states</span>
<span class="va">states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>state_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,
                     state_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Stage 1"</span>, <span class="st">"Stage 2"</span><span class="op">)</span><span class="op">)</span> 

<span class="co"># Transitions</span>
<span class="va">tmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,
              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="cn">NA</span>, <span class="fl">4</span><span class="op">)</span>,
              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">tmat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">tmat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Stage 1"</span>, <span class="st">"Stage 2"</span>, <span class="st">"Death"</span><span class="op">)</span>
<span class="va">transitions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_trans_dt.html">create_trans_dt</a></span><span class="op">(</span><span class="va">tmat</span><span class="op">)</span>
<span class="va">transitions</span><span class="op">[</span>, <span class="va">trans</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">transition_id</span><span class="op">)</span><span class="op">]</span>

<span class="co"># Combining</span>
<span class="va">hesim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hesim_data.html">hesim_data</a></span><span class="op">(</span>strategies <span class="op">=</span> <span class="va">strategies</span>,
                        patients <span class="op">=</span> <span class="va">patients</span>, 
                        states <span class="op">=</span> <span class="va">states</span>,
                        transitions <span class="op">=</span> <span class="va">transitions</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">hesim_dat</span><span class="op">)</span></code></pre></div>
<pre><code>## $strategies
##    strategy_id strategy_name
## 1:           1           SOC
## 2:           2           New
## 
## $patients
##       patient_id      age female grp_id grp_name
##    1:          1 44.82279      0      2     Male
##    2:          2 48.04470      1      1   Female
##    3:          3 47.83577      1      1   Female
##    4:          4 42.26179      1      1   Female
##    5:          5 50.91485      1      1   Female
##   ---                                           
##  996:        996 52.20899      1      1   Female
##  997:        997 38.27982      0      2     Male
##  998:        998 45.46669      1      1   Female
##  999:        999 42.16867      0      2     Male
## 1000:       1000 40.23973      1      1   Female
## 
## $states
##    state_id state_name
## 1:        1    Stage 1
## 2:        2    Stage 2
## 
## $transitions
##    transition_id from to from_name to_name trans
## 1:             1    1  2   Stage 1 Stage 2     1
## 2:             2    1  3   Stage 1   Death     2
## 3:             3    2  1   Stage 2 Stage 1     3
## 4:             4    2  3   Stage 2   Death     4
## 
## attr(,"class")
## [1] "hesim_data"</code></pre>
<p>When presenting results, it may be preferable to have more informative labels that the ID variables. These can be generated from a <code>hesim_data</code> object using <code><a href="../reference/get_labels.html">get_labels()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_labels.html">get_labels</a></span><span class="op">(</span><span class="va">hesim_dat</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">labs</span><span class="op">)</span></code></pre></div>
<pre><code>## $strategy_id
## SOC New 
##   1   2 
## 
## $grp_id
## Female   Male 
##      1      2 
## 
## $state_id
## Stage 1 Stage 2   Death 
##       1       2       3</code></pre>
</div>
<div id="parameterization" class="section level1">
<h1 class="hasAnchor">
<a href="#parameterization" class="anchor"></a>Parameterization</h1>
<p>Each submodel contains fields for the model parameters and the input data. Models can be parameterized by either fitting statistical models using <code>R</code>, inputting values directly, or from a combination of the two. There are two types of parameter objects, standard parameter objects prefixed by “params” and “transformed” parameter objects prefixed by “tparams”. The former contain the underlying parameters of a statistical model and are used alongside the input data to make predictions. The latter contain parameters more immediate to prediction that have already been transformed as function of the input data. The regression coefficients of a logistic regression are an example of a parameter objects while the predicted probabilities are examples of a transformed parameter object.</p>
<div id="disease-progression" class="section level2">
<h2 class="hasAnchor">
<a href="#disease-progression" class="anchor"></a>Disease progression</h2>
<p>As shown in the table below, the statistical model used to parameterize the disease model varies by the type of economic model. For example, multinomial logistic regressions can be used to parameterize a cDTSTM, a set of <em>N-1</em> independent survival models are used to parameterize an <em>N</em>-state partitioned survival model, and multi-state models can be used to parameterize an iCTSTM.</p>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
Economic model (R6 class)
</th>
<th style="text-align:left;">
Statistical model
</th>
<th style="text-align:left;">
Parameter object
</th>
<th style="text-align:left;">
Model object
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
<code><a href="../reference/CohortDtstm.html">hesim::CohortDtstm</a></code>
</td>
<td style="text-align:left;">
Custom
</td>
<td style="text-align:left;">
<code><a href="../reference/tparams_transprobs.html">hesim::tparams_transprobs</a></code>
</td>
<td style="text-align:left;">
<code><a href="https://rdrr.io/pkg/msm/man/msm.html">msm::msm</a></code>
</td>
</tr>
<tr>
<td style="text-align:left;">
Multinomial logistic regressions
</td>
<td style="text-align:left;">
<code><a href="../reference/params_mlogit_list.html">hesim::params_mlogit_list</a></code>
</td>
<td style="text-align:left;">
<code><a href="../reference/multinom_list.html">hesim::multinom_list</a></code>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="../reference/Psm.html">hesim::Psm</a></code>
</td>
<td style="text-align:left;">
Independent survival models
</td>
<td style="text-align:left;">
<code><a href="../reference/params_surv_list.html">hesim::params_surv_list</a></code>
</td>
<td style="text-align:left;">
<code><a href="../reference/flexsurvreg_list.html">hesim::flexsurvreg_list</a></code>
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
<code><a href="../reference/IndivCtstm.html">hesim::IndivCtstm</a></code>
</td>
<td style="text-align:left;">
Multi-state model (joint likelihood)
</td>
<td style="text-align:left;">
<code><a href="../reference/params_surv.html">hesim::params_surv</a></code>
</td>
<td style="text-align:left;">
<code><a href="https://rdrr.io/pkg/flexsurv/man/flexsurvreg.html">flexsurv::flexsurvreg</a></code>
</td>
</tr>
<tr>
<td style="text-align:left;">
Multi-state model (transition-specific)
</td>
<td style="text-align:left;">
<code><a href="../reference/params_surv_list.html">hesim::params_surv_list</a></code>
</td>
<td style="text-align:left;">
<code><a href="../reference/flexsurvreg_list.html">hesim::flexsurvreg_list</a></code>
</td>
</tr>
</tbody>
</table>
<p>The parameters of a survival model are stored in a <code>params_surv</code> object and a <code>params_surv_list</code> can be used to store the parameters of multiple survival models. The latter is useful for storing the parameters of a multi-state model or the independent survival models required for a PSM. The parameters of a multinomial logistic regression are stored in a <code>params_mlogit</code> object and can be created by fitting a model for each row in a transition probability matrix with <code><a href="https://rdrr.io/pkg/nnet/man/multinom.html">nnet::multinom()</a></code>. <code>tparams_transprobs</code> objects are examples of transformed parameter objects that store transition probability matrices. They can be predicted from a fitted multi-state model using the <code>msm</code> package or constructed “by hand” in a custom manner.</p>
<p>We illustrate an example of a statistical model of disease progression fit with <code>R</code> by estimating a multi-state model with a joint likelihood using <code><a href="https://rdrr.io/pkg/flexsurv/man/flexsurvreg.html">flexsurv::flexsurvreg()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/chjackson/flexsurv-dev">"flexsurv"</a></span><span class="op">)</span>
<span class="va">mstate_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span><span class="va">mstate3_exdata</span><span class="op">$</span><span class="va">transitions</span><span class="op">)</span>
<span class="va">mstate_data</span><span class="op">[</span>, <span class="va">trans</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">trans</span><span class="op">)</span><span class="op">]</span>
<span class="va">fit_wei</span> <span class="op">&lt;-</span> <span class="fu">flexsurv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/flexsurv/man/flexsurvreg.html">flexsurvreg</a></span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">years</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">trans</span> <span class="op">+</span> 
                                                       <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">strategy_id</span><span class="op">)</span><span class="op">:</span><span class="va">trans</span> <span class="op">+</span>
                                                       <span class="va">age</span><span class="op">:</span><span class="va">trans</span> <span class="op">+</span> 
                                                       <span class="va">female</span><span class="op">:</span> <span class="va">trans</span> <span class="op">+</span>
                                                       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_linetype_size_shape.html">shape</a></span><span class="op">(</span><span class="va">trans</span><span class="op">)</span>, 
                                 data <span class="op">=</span> <span class="va">mstate_data</span>, 
                                 dist <span class="op">=</span> <span class="st">"weibull"</span><span class="op">)</span></code></pre></div>
</div>
<div id="costs-and-utility" class="section level2">
<h2 class="hasAnchor">
<a href="#costs-and-utility" class="anchor"></a>Costs and utility</h2>
<p>State values (i.e., utilities and costs) do not depend on the choice of disease model. They can currently either be modeled using a linear model or with predicted means.</p>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
Statistical model
</th>
<th style="text-align:left;">
Parameter object
</th>
<th style="text-align:left;">
Model object
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Predicted means
</td>
<td style="text-align:left;">
<code><a href="../reference/tparams_mean.html">hesim::tparams_mean</a></code>
</td>
<td style="text-align:left;">
<code><a href="../reference/stateval_tbl.html">hesim::stateval_tbl</a></code>
</td>
</tr>
<tr>
<td style="text-align:left;">
Linear model
</td>
<td style="text-align:left;">
<code><a href="../reference/params_lm.html">hesim::params_lm</a></code>
</td>
<td style="text-align:left;">
<code><a href="https://rdrr.io/r/stats/lm.html">stats::lm</a></code>
</td>
</tr>
</tbody>
</table>
<p>The most straightforward way to construct state values is with <code><a href="../reference/stateval_tbl.html">stateval_tbl()</a></code>, which creates a special object used to assign values (i.e. predicted means) to health states that can vary across PSA samples, treatment strategies, patients, and/or time intervals. State values can be specified either as moments (e.g., mean and standard error) or parameters (e.g., shape and scale of gamma distribution) of a probability distribution, or by pre-simulating values from a suitable probability distribution (e.g., from a Bayesian model). Here we will use <code>stateval_tbl</code> objects for utility and two cost categories (drug and medical).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Utility</span>
<span class="va">utility_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stateval_tbl.html">stateval_tbl</a></span><span class="op">(</span>
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>state_id <span class="op">=</span> <span class="va">states</span><span class="op">$</span><span class="va">state_id</span>,
             mean <span class="op">=</span> <span class="va">mstate3_exdata</span><span class="op">$</span><span class="va">utility</span><span class="op">$</span><span class="va">mean</span>,
             se <span class="op">=</span> <span class="va">mstate3_exdata</span><span class="op">$</span><span class="va">utility</span><span class="op">$</span><span class="va">se</span><span class="op">)</span>,
  dist <span class="op">=</span> <span class="st">"beta"</span>
<span class="op">)</span>

<span class="co"># Costs</span>
<span class="va">drugcost_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stateval_tbl.html">stateval_tbl</a></span><span class="op">(</span>
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>strategy_id <span class="op">=</span> <span class="va">strategies</span><span class="op">$</span><span class="va">strategy_id</span>,
             est <span class="op">=</span> <span class="va">mstate3_exdata</span><span class="op">$</span><span class="va">costs</span><span class="op">$</span><span class="va">drugs</span><span class="op">$</span><span class="va">costs</span><span class="op">)</span>,
  dist <span class="op">=</span> <span class="st">"fixed"</span>
<span class="op">)</span>

<span class="va">medcost_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stateval_tbl.html">stateval_tbl</a></span><span class="op">(</span>
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>state_id <span class="op">=</span> <span class="va">states</span><span class="op">$</span><span class="va">state_id</span>,
             mean <span class="op">=</span> <span class="va">mstate3_exdata</span><span class="op">$</span><span class="va">costs</span><span class="op">$</span><span class="va">medical</span><span class="op">$</span><span class="va">mean</span>,
             se <span class="op">=</span> <span class="va">mstate3_exdata</span><span class="op">$</span><span class="va">costs</span><span class="op">$</span><span class="va">medical</span><span class="op">$</span><span class="va">se</span><span class="op">)</span>,
  dist <span class="op">=</span> <span class="st">"gamma"</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">utility_tbl</span><span class="op">)</span></code></pre></div>
<pre><code>##    state_id mean        se
## 1:        1 0.65 0.1732051
## 2:        2 0.85 0.2000000</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">drugcost_tbl</span><span class="op">)</span></code></pre></div>
<pre><code>##    strategy_id   est
## 1:           1  5000
## 2:           2 10000</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">medcost_tbl</span><span class="op">)</span></code></pre></div>
<pre><code>##    state_id mean       se
## 1:        1 1000 10.95445
## 2:        2 1600 14.14214</code></pre>
</div>
</div>
<div id="simulation" class="section level1">
<h1 class="hasAnchor">
<a href="#simulation" class="anchor"></a>Simulation</h1>
<div id="constructing-an-economic-model" class="section level2">
<h2 class="hasAnchor">
<a href="#constructing-an-economic-model" class="anchor"></a>Constructing an economic model</h2>
<p>The utility and cost models are always <code><a href="../reference/StateVals.html">hesim::StateVals</a></code> objects, whereas the disease models vary by economic model. The disease model is used to simulate survival curves in a PSM and health state transitions in a cDTSTM and iCTSTM.</p>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
Economic model
</th>
<th style="text-align:left;">
Disease model
</th>
<th style="text-align:left;">
Utility model
</th>
<th style="text-align:left;">
Cost model(s)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<code><a href="../reference/CohortDtstm.html">hesim::CohortDtstm</a></code>
</td>
<td style="text-align:left;">
<code><a href="../reference/CohortDtstmTrans.html">hesim::CohortDtstmTrans</a></code>
</td>
<td style="text-align:left;">
<code><a href="../reference/StateVals.html">hesim::StateVals</a></code>
</td>
<td style="text-align:left;">
<code><a href="../reference/StateVals.html">hesim::StateVals</a></code>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="../reference/Psm.html">hesim::Psm</a></code>
</td>
<td style="text-align:left;">
<code><a href="../reference/PsmCurves.html">hesim::PsmCurves</a></code>
</td>
<td style="text-align:left;">
<code><a href="../reference/StateVals.html">hesim::StateVals</a></code>
</td>
<td style="text-align:left;">
<code><a href="../reference/StateVals.html">hesim::StateVals</a></code>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="../reference/IndivCtstm.html">hesim::IndivCtstm</a></code>
</td>
<td style="text-align:left;">
<code><a href="../reference/IndivCtstmTrans.html">hesim::IndivCtstmTrans</a></code>
</td>
<td style="text-align:left;">
<code><a href="../reference/StateVals.html">hesim::StateVals</a></code>
</td>
<td style="text-align:left;">
<code><a href="../reference/StateVals.html">hesim::StateVals</a></code>
</td>
</tr>
</tbody>
</table>
<p>The submodels are constructed from (i) parameter or model objects and (ii) input data (if a transformed parameter object is not used). They can be instantiated using <code>S3</code> generic methods prefixed by “<code>create</code>” or with the <code>R6</code> constructor method <code>$new()</code>. We illustrate use of the former below.</p>
<p>In all cases, it is necessary to specify the number of parameter samples to use for the PSA.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n_samples</span> <span class="op">&lt;-</span> <span class="fl">1000</span></code></pre></div>
<div id="disease-model" class="section level3">
<h3 class="hasAnchor">
<a href="#disease-model" class="anchor"></a>Disease model</h3>
<p>The disease model is constructed as a function of the fitted multi-state model (using the stored regression coefficients) and input data. The input data must be an object of class <code>expanded_hesim_data</code>, which is a <a href="https://rdatatable.gitlab.io/data.table/"><code>data.table</code></a> containing the covariates for the statistical model. In our multi-state model, each row is a unique treatment strategy, patient, and health-state transition.</p>
<p>An <code>expanded_hesim_data</code> object can be created by expanding an object of class <code>hesim_data</code> using <code><a href="../reference/expand.hesim_data.html">expand.hesim_data()</a></code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">transmod_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expand.html">expand</a></span><span class="op">(</span><span class="va">hesim_dat</span>, 
                        by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"strategies"</span>, <span class="st">"patients"</span>, <span class="st">"transitions"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">transmod_data</span><span class="op">)</span></code></pre></div>
<pre><code>##    strategy_id patient_id transition_id strategy_name      age female grp_id
## 1:           1          1             1           SOC 44.82279      0      2
## 2:           1          1             2           SOC 44.82279      0      2
## 3:           1          1             3           SOC 44.82279      0      2
## 4:           1          1             4           SOC 44.82279      0      2
## 5:           1          2             1           SOC 48.04470      1      1
## 6:           1          2             2           SOC 48.04470      1      1
##    grp_name from to from_name to_name trans
## 1:     Male    1  2   Stage 1 Stage 2     1
## 2:     Male    1  3   Stage 1   Death     2
## 3:     Male    2  1   Stage 2 Stage 1     3
## 4:     Male    2  3   Stage 2   Death     4
## 5:   Female    1  2   Stage 1 Stage 2     1
## 6:   Female    1  3   Stage 1   Death     2</code></pre>
<p>The disease model is instantiated using the <code><a href="../reference/create_IndivCtstmTrans.html">create_IndivCtstmTrans()</a></code> generic method. Parameters for the PSA are, by default, drawn from the multivariate normal distribution of the maximum likelihood estimate of the regression coefficients, although we make this explicit with the uncertainty argument.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">transmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_IndivCtstmTrans.html">create_IndivCtstmTrans</a></span><span class="op">(</span><span class="va">fit_wei</span>, <span class="va">transmod_data</span>,
                                   trans_mat <span class="op">=</span> <span class="va">tmat</span>, n <span class="op">=</span> <span class="va">n_samples</span>,
                                   uncertainty <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">transmod</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "IndivCtstmTrans" "CtstmTrans"      "R6"</code></pre>
</div>
<div id="cost-and-utility-models" class="section level3">
<h3 class="hasAnchor">
<a href="#cost-and-utility-models" class="anchor"></a>Cost and utility models</h3>
<p>Since we are using predicted means for utilities and costs, we do not need to specify input data. Instead, we can construct the utility and cost models directly from the <code>stateval_tbl</code> objects.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Utility</span>
<span class="va">utilitymod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_StateVals.html">create_StateVals</a></span><span class="op">(</span><span class="va">utility_tbl</span>, n <span class="op">=</span> <span class="va">n_samples</span>, hesim_data <span class="op">=</span> <span class="va">hesim_dat</span><span class="op">)</span>

<span class="co"># Costs</span>
<span class="va">drugcostmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_StateVals.html">create_StateVals</a></span><span class="op">(</span><span class="va">drugcost_tbl</span>, n <span class="op">=</span> <span class="va">n_samples</span>, hesim_data <span class="op">=</span> <span class="va">hesim_dat</span><span class="op">)</span>
<span class="va">medcostmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_StateVals.html">create_StateVals</a></span><span class="op">(</span><span class="va">medcost_tbl</span>, n <span class="op">=</span> <span class="va">n_samples</span>, hesim_data <span class="op">=</span> <span class="va">hesim_dat</span><span class="op">)</span>
<span class="va">costmods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>drugs <span class="op">=</span> <span class="va">drugcostmod</span>,
                 medical <span class="op">=</span> <span class="va">medcostmod</span><span class="op">)</span></code></pre></div>
</div>
<div id="combining-the-disease-progression-cost-and-utility-models" class="section level3">
<h3 class="hasAnchor">
<a href="#combining-the-disease-progression-cost-and-utility-models" class="anchor"></a>Combining the disease progression, cost, and utility models</h3>
<p>Once the disease, utility, and cost models have been constructed, we combine them to create the full economic model using <code>$new()</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ictstm</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/IndivCtstm.html">IndivCtstm</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>trans_model <span class="op">=</span> <span class="va">transmod</span>,
                         utility_model <span class="op">=</span> <span class="va">utilitymod</span>,
                         cost_models <span class="op">=</span> <span class="va">costmods</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="simulating-outcomes" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-outcomes" class="anchor"></a>Simulating outcomes</h2>
<p>Each economic model contains methods (i.e., functions) for simulating disease progression, QALYs, and costs.</p>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
Economic model (R6 class)
</th>
<th style="text-align:left;">
Disease progression
</th>
<th style="text-align:left;">
QALYs
</th>
<th style="text-align:left;">
Costs
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<code><a href="../reference/CohortDtstm.html">hesim::CohortDtstm</a></code>
</td>
<td style="text-align:left;">
$sim_stateprobs()
</td>
<td style="text-align:left;">
$sim_qalys()
</td>
<td style="text-align:left;">
$sim_costs()
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="../reference/Psm.html">hesim::Psm</a></code>
</td>
<td style="text-align:left;">
$sim_survival() and $sim_stateprobs()
</td>
<td style="text-align:left;">
$sim_qalys()
</td>
<td style="text-align:left;">
$sim_costs()
</td>
</tr>
<tr>
<td style="text-align:left;">
<code><a href="../reference/IndivCtstm.html">hesim::IndivCtstm</a></code>
</td>
<td style="text-align:left;">
$sim_disease() and $sim_stateprobs()
</td>
<td style="text-align:left;">
$sim_qalys()
</td>
<td style="text-align:left;">
$sim_costs()
</td>
</tr>
</tbody>
</table>
<p>Although all models simulate state probabilities, they do so in different ways. The cDTSTM uses discrete time Markov chains, the PSM calculates differences in probabilities from simulated survival curves, and the iCTSTM aggregates individual trajectories simulated using random number generation. The individual-level simulation is advantageous because it can be used for semi-Markov processes where transition rates depend on time since entering a health state (rather than time since the start of the model).</p>
<p>The utility and cost models always simulate QALYs and costs from the simulated progression of disease with the methods <code>$sim_qalys()</code> and <code>$sim_costs()</code>, respectively. In the cohort models, QALYs and costs are computed as a function of the state probabilities whereas in individual-level models they are based on the simulated individual trajectories. Like the disease model, the individual-level simulation is more flexible because QALYs and costs can depend on time since entering the health state.</p>
<p>We illustrate with the iCTSTM. The first step is to simulate disease progression for each patient.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ictstm</span><span class="op">$</span><span class="fu">sim_disease</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ictstm</span><span class="op">$</span><span class="va">disprog_</span><span class="op">)</span></code></pre></div>
<pre><code>##    sample strategy_id patient_id grp_id from to final time_start time_stop
## 1:      1           1          1      2    1  2     0   0.000000  3.902454
## 2:      1           1          1      2    2  1     0   3.902454  7.697896
## 3:      1           1          1      2    1  2     0   7.697896 15.265023
## 4:      1           1          1      2    2  1     0  15.265023 15.508464
## 5:      1           1          1      2    1  2     0  15.508464 16.138897
## 6:      1           1          1      2    2  1     0  16.138897 17.741191</code></pre>
<p>The disease trajectory is summarized with <code>$sim_stateprobs()</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ictstm</span><span class="op">$</span><span class="fu">sim_stateprobs</span><span class="op">(</span>t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ictstm</span><span class="op">$</span><span class="va">stateprobs_</span><span class="op">)</span></code></pre></div>
<pre><code>##    sample strategy_id grp_id state_id t  prob
## 1:      1           1      2        1 0 0.516
## 2:      1           1      2        1 1 0.443
## 3:      1           1      2        1 2 0.403
## 4:      1           1      2        1 3 0.373
## 5:      1           1      2        1 4 0.354
## 6:      1           1      2        1 5 0.331</code></pre>
<p>Finally, we compute QALYs and costs (using a discount rate of 3 percent).</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># QALYs</span>
<span class="va">ictstm</span><span class="op">$</span><span class="fu">sim_qalys</span><span class="op">(</span>dr <span class="op">=</span> <span class="fl">.03</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ictstm</span><span class="op">$</span><span class="va">qalys_</span><span class="op">)</span></code></pre></div>
<pre><code>##    sample strategy_id grp_id state_id   dr     qalys       lys
## 1:      1           1      1        1 0.03 1.6167560 3.9968741
## 2:      1           1      1        2 0.03 0.6251777 0.6823150
## 3:      1           1      2        1 0.03 2.0866257 5.1584655
## 4:      1           1      2        2 0.03 0.7714144 0.8419168
## 5:      1           2      1        1 0.03 1.6369116 4.0467019
## 6:      1           2      1        2 0.03 0.3515107 0.3836366</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Costs</span>
<span class="va">ictstm</span><span class="op">$</span><span class="fu">sim_costs</span><span class="op">(</span>dr <span class="op">=</span> <span class="fl">.03</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ictstm</span><span class="op">$</span><span class="va">costs_</span><span class="op">)</span></code></pre></div>
<pre><code>##    sample strategy_id grp_id state_id   dr category     costs
## 1:      1           1      1        1 0.03    drugs 19984.370
## 2:      1           1      1        2 0.03    drugs  3411.575
## 3:      1           1      2        1 0.03    drugs 25792.328
## 4:      1           1      2        2 0.03    drugs  4209.584
## 5:      1           2      1        1 0.03    drugs 40467.019
## 6:      1           2      1        2 0.03    drugs  3836.366</code></pre>
</div>
</div>
<div id="decision-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#decision-analysis" class="anchor"></a>Decision analysis</h1>
<p>Once output has been simulated with an economic model, a decision analysis can be performed. CEAs can be conducted using other <code>R</code> packages such as <a href="https://sites.google.com/a/statistica.it/gianluca/bcea">BCEA</a> or directly with <code>hesim</code>.</p>
<p>To perform a CEA, simulated QALYs and costs are summarized and a <code>ce</code> object is created, which contains mean QALYs and costs for each sample from the PSA by treatment strategy. QALYs and costs can either be summarized by subgroup (<code>by_grp = TRUE</code>) or aggregated across all patients (<code>by_grp = FALSE</code>).</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ce</span> <span class="op">&lt;-</span> <span class="va">ictstm</span><span class="op">$</span><span class="fu">summarize</span><span class="op">(</span>by_grp <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ce</span><span class="op">)</span></code></pre></div>
<pre><code>## $costs
##       category   dr sample strategy_id     costs grp_id
##    1:    drugs 0.03      1           1  53397.86      1
##    2:    drugs 0.03      1           2 103607.41      1
##    3:    drugs 0.03      2           1  56249.16      1
##    4:    drugs 0.03      2           2 109611.72      1
##    5:    drugs 0.03      3           1  53020.56      1
##   ---                                                  
## 5996:    total 0.03    998           2 125174.36      1
## 5997:    total 0.03    999           1  69946.35      1
## 5998:    total 0.03    999           2 130088.06      1
## 5999:    total 0.03   1000           1  70064.44      1
## 6000:    total 0.03   1000           2 114940.01      1
## 
## $qalys
##         dr sample strategy_id    qalys grp_id
##    1: 0.03      1           1 5.099974      1
##    2: 0.03      1           2 4.644957      1
##    3: 0.03      2           1 5.445996      1
##    4: 0.03      2           2 5.401203      1
##    5: 0.03      3           1 8.500340      1
##   ---                                        
## 1996: 0.03    998           2 7.470210      1
## 1997: 0.03    999           1 9.602197      1
## 1998: 0.03    999           2 9.757866      1
## 1999: 0.03   1000           1 4.758596      1
## 2000: 0.03   1000           2 4.179787      1
## 
## attr(,"class")
## [1] "ce"</code></pre>
<p>The functions <code><a href="../reference/cea.html">cea()</a></code> and <code><a href="../reference/cea.html">cea_pw()</a></code> are used to perform a CEA. The former simultaneously accounts for all treatment strategies while the latter makes pairwise comparisons between interventions and a chosen comparator.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cea_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cea.html">cea</a></span><span class="op">(</span><span class="va">ce</span>, dr_qalys <span class="op">=</span> <span class="fl">.03</span>, dr_costs <span class="op">=</span> <span class="fl">.03</span><span class="op">)</span>
<span class="va">cea_pw_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cea.html">cea_pw</a></span><span class="op">(</span><span class="va">ce</span>, dr_qalys <span class="op">=</span> <span class="fl">.03</span>, dr_costs <span class="op">=</span> <span class="fl">.03</span>, comparator <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>Summary and plotting functions are available to analyze the output. For instance, we can use <code><a href="../reference/plot_ceac.html">plot_ceac()</a></code> to quickly plot a cost-effectiveness acceptability curve (CEAC), which displays the probability that each treatment strategy is the most cost-effective at a given willingness to pay for a QALY. The labels we constructed earlier are used to give the treatment strategies informative names.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org">"ggplot2"</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/plot_ceac.html">plot_ceac</a></span><span class="op">(</span><span class="va">cea_out</span>, labels <span class="op">=</span> <span class="va">labs</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="intro_files/figure-html/ceac_plot-1.png" width="576"></p>
</div>
<div id="next-steps" class="section level1">
<h1 class="hasAnchor">
<a href="#next-steps" class="anchor"></a>Next steps</h1>
<p>This article provided an overview of the <code>hesim</code> package. We recommend exploring the examples in the other articles to learn more.</p>
<p>cDTSTMs (i.e., Markov cohort models) are probably the most commonly used models in health economics and there are examples demonstrating multiple ways to build them with <code>hesim</code>. One approach that has not yet been discussed is a functional one that allows users to define a model (with <code><a href="../reference/define_model.html">define_model()</a></code>) in terms of expressions that transform underlying parameter draws from a PSA into relevant transformed parameters (e.g., transition probability matrices, mean state values) as a function of input data.</p>
<p>Other relevant topics include more through treatments of CEA, multi-state modeling, individual-level simulations based on aggregate data, and partitioned survival analysis. As the examples illustrate, any analysis can be performed either for a single group or in the context of multiple subgroups.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Jeroen P. Jansen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
