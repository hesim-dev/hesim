<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simple Markov cohort model • hesim</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simple Markov cohort model">
<meta property="og:description" content="hesim">
<meta property="og:image" content="https://hesim-dev.github.io/hesim/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-131661920-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-131661920-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hesim</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.5.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">API</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction to hesim</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Cohort discrete time state transition models</li>
    <li>
      <a href="../articles/markov-cohort.html">Simple Markov cohort model</a>
    </li>
    <li>
      <a href="../articles/markov-inhomogeneous-cohort.html">Time inhomogeneous Markov cohort models</a>
    </li>
    <li>
      <a href="../articles/mlogit.html">Markov models with multinomial logistic regression</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Individual continuous time state transition models</li>
    <li>
      <a href="../articles/markov-inhomogeneous-indiv.html">Time inhomogeneous Markov individual-level models</a>
    </li>
    <li>
      <a href="../articles/mstate.html">Markov and semi-Markov multi-state models</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Partitioned survival analysis</li>
    <li>
      <a href="../articles/psm.html">N-state partitioned survival models</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Decision analysis</li>
    <li>
      <a href="../articles/cea.html">Cost-effectiveness analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/benchmarks.html">Benchmarks</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hesim-dev/hesim/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Simple Markov cohort model</h1>
            
            <h4 data-toc-skip class="date">2024-02-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hesim-dev/hesim/blob/HEAD/vignettes/markov-cohort.Rmd" class="external-link"><code>vignettes/markov-cohort.Rmd</code></a></small>
      <div class="hidden name"><code>markov-cohort.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The simplest models in <code>hesim</code> are cohort discrete time
state transitions models (cDTSTMs), which encompass both
time-homogeneous and time-inhomogeneous Markov models. Transition
probabilities between states are constant over time in time-homogeneous
models whereas they can vary over time in time-inhomogeneous models.</p>
<p>We consider a simple example by replicating the HIV model developed
by <a href="https://link.springer.com/article/10.2165/00019053-199712010-00006" class="external-link">Chancellor
et al.</a> and used for didactic purposes in the <a href="https://www.herc.ox.ac.uk/downloads/decision-modelling-for-health-economic-evaluation" class="external-link"><em>Decision
Modeling for Health Economic Evaluation</em></a> textbook. The analysis
compares two treatment strategies, zidovudine monotherapy and zidovudine
+ lamivudine combination therapy. While the model is technically
time-inhomogeneous because patients are assumed to only use lamivudine
for 2 years before switching back to monotherapy, transition
probabilities only change once so it might be referred to as (mostly)
homogeneous.</p>
<p>The model consists 4 health states. Ordered from worst to best to
worst, they are: State A (CD4 cells &gt; 200 and &lt; 500 cells/mm3),
State B (CD4 &lt; 200 cells/mm3), State C (AIDS), and State D (death).
The model assumes that patients can transition to any state that is more
severe (i.e., progress) but cannot transition back to a more severe
state.</p>
<p><img src="markov-cohort.png" width="700px"></p>
<p>Transition probability matrices are the core of any cDTSTM. They can,
in general, be constructed by either (i) using an explicit statistical
model (e.g., via <code><a href="../reference/params_mlogit.html">params_mlogit()</a></code>) or (ii) by specifying
transition probabilities for each parameter sample, treatment strategy,
patient, and (optionally) time interval (e.g., via
<code><a href="../reference/tparams_transprobs.html">tparams_transprobs()</a></code>). The latter can either by done by
constructing the transition probability matrices directly “by hand” or
by defining the model in terms of expressions with
<code><a href="../reference/define_model.html">define_model()</a></code>. We will construct a
<code>tparams_transprobs</code> object with
<code><a href="../reference/define_model.html">define_model()</a></code>in this vignette, but an example without it
is available in the <code><a href="../reference/CohortDtstm.html">?CohortDtstm</a></code> help file.</p>
</div>
<div class="section level2">
<h2 id="model-setup">Model setup<a class="anchor" aria-label="anchor" href="#model-setup"></a>
</h2>
<p>We set up the model for two treatment strategies and one
representative patient.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://hesim-dev.github.io/hesim/">"hesim"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://r-datatable.com" class="external-link">"data.table"</a></span><span class="op">)</span></span>
<span><span class="va">strategies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>strategy_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>                         strategy_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Monotherapy"</span>, <span class="st">"Combination therapy"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">patients</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>patient_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>state_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>                     state_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"State A"</span>, <span class="st">"State B"</span>, <span class="st">"State C"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hesim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hesim_data.html">hesim_data</a></span><span class="op">(</span>strategies <span class="op">=</span> <span class="va">strategies</span>,</span>
<span>                        patients <span class="op">=</span> <span class="va">patients</span>,</span>
<span>                        states <span class="op">=</span> <span class="va">states</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">hesim_dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $strategies</span></span>
<span><span class="co">##    strategy_id       strategy_name</span></span>
<span><span class="co">##          &lt;int&gt;              &lt;char&gt;</span></span>
<span><span class="co">## 1:           1         Monotherapy</span></span>
<span><span class="co">## 2:           2 Combination therapy</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $patients</span></span>
<span><span class="co">##    patient_id</span></span>
<span><span class="co">##         &lt;num&gt;</span></span>
<span><span class="co">## 1:          1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $states</span></span>
<span><span class="co">##    state_id state_name</span></span>
<span><span class="co">##       &lt;int&gt;     &lt;char&gt;</span></span>
<span><span class="co">## 1:        1    State A</span></span>
<span><span class="co">## 2:        2    State B</span></span>
<span><span class="co">## 3:        3    State C</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "hesim_data"</span></span></code></pre>
<p>The <code><a href="../reference/get_labels.html">get_labels()</a></code> function can be used to obtain nice
labels for plots and summary tables.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_labels.html">get_labels</a></span><span class="op">(</span><span class="va">hesim_dat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">labs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $strategy_id</span></span>
<span><span class="co">##         Monotherapy Combination therapy </span></span>
<span><span class="co">##                   1                   2 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $state_id</span></span>
<span><span class="co">## State A State B State C   Death </span></span>
<span><span class="co">##       1       2       3       4</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="model-parameters">Model parameters<a class="anchor" aria-label="anchor" href="#model-parameters"></a>
</h2>
<div class="section level3">
<h3 id="estimates-from-the-literature">Estimates from the literature<a class="anchor" aria-label="anchor" href="#estimates-from-the-literature"></a>
</h3>
<p>Counts of transitions at yearly intervals between each of the 4
health states were available from a longitudinal dataset from Chelsea
and Westminister hospital.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans_mono</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1251</span>, <span class="fl">350</span>, <span class="fl">116</span>, <span class="fl">17</span>,</span>
<span>                       <span class="fl">0</span>, <span class="fl">731</span>, <span class="fl">512</span>, <span class="fl">15</span>,</span>
<span>                       <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1312</span>, <span class="fl">437</span>,</span>
<span>                       <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">469</span><span class="op">)</span>,</span>
<span>                      ncol <span class="op">=</span> <span class="fl">4</span>, nrow <span class="op">=</span> <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">trans_mono</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">trans_mono</span><span class="op">)</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">trans_mono</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      A   B    C   D</span></span>
<span><span class="co">## A 1251 350  116  17</span></span>
<span><span class="co">## B    0 731  512  15</span></span>
<span><span class="co">## C    0   0 1312 437</span></span>
<span><span class="co">## D    0   0    0 469</span></span></code></pre>
<p>The transition probabilities from state <span class="math inline">\(r\)</span> to each of the 4 states (State A, State
B, State C, and State D) can be modeled using Dirichlet distributions,
which are parameterized by a vector of concentration parameters <span class="math inline">\(\alpha = (\alpha_{r1}, \alpha_{r2}, \alpha_{r3},
\alpha_{r4})\)</span>. The Dirichlet distribution is particularly useful
for modeling uncertainty in the transition probabilities because it is a
conjugate prior for the multinomial distribution. The posterior
distribution of <span class="math inline">\(\alpha\)</span> consequently
follows a Dirichlet distribution which can be thought of as the
“effective sample size” for each transition (see Appendix).</p>
<p>Treatment effects are defined in terms of the relative risk, which is
assumed to reduce the probability of all transitions to a more severe
health state by an equal amount. We work with the log relative risk
since it is approximately normally distributed. The estimated relative
risk of disease progression is 0.509 (95% CI 0.365 to 0.710). We can
then calculate the mean and standard error on the log scale.</p>
<p>The cost-effectiveness analysis is based on life-years, meaning that
each health state is assigned a utility value of 1. The costs of
zidovudine and lamivudine are $2,278 and $2,086.50, respectively.
Medical costs are split into direct medical and community medical
costs.</p>
<p>The parameter estimates are stored in a list.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  alpha_mono <span class="op">=</span> <span class="va">trans_mono</span>, </span>
<span>  lrr_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.509</span><span class="op">)</span>, </span>
<span>  <span class="va">lrr_lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.365</span><span class="op">)</span>,</span>
<span>  lrr_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.710</span><span class="op">)</span>,</span>
<span>  c_dmed_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">1701</span>, B <span class="op">=</span> <span class="fl">1774</span>, C <span class="op">=</span> <span class="fl">6948</span><span class="op">)</span>,</span>
<span>  c_cmed_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">1055</span>, B <span class="op">=</span> <span class="fl">1278</span>, C <span class="op">=</span> <span class="fl">2059</span><span class="op">)</span>,</span>
<span>  c_zido <span class="op">=</span> <span class="fl">2278</span>,</span>
<span>  c_lam <span class="op">=</span> <span class="fl">2086.50</span>,</span>
<span>  u <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="random-number-generation">Random number generation<a class="anchor" aria-label="anchor" href="#random-number-generation"></a>
</h3>
<p>To perform a probabilistic sensitivity analysis (PSA), it is
necessary to draw samples of the parameters from suitable probability
distributions. While the probability distributions could have been drawn
manually and stored in the <code>params</code> object above, it can be
more easily done by using random number generation functions with
<code><a href="../reference/define_rng.html">define_rng()</a></code>.</p>
<p>As noted above, we draw the transition probabilities with monotherapy
from a Dirichlet distribution and the relative risk (of a transition to
a worse state with combination therapy relative to monotherapy) from a
lognormal distribution. Drug costs and utility are assumed to be fixed
while medical costs are drawn from gamma distributions.</p>
<p>Sampled parameters values are stored in a list, meaning that samples
for each parameter can be stored as either a vector or
<code>data.table</code> (or matrix or <code>data.frame</code>). For
instance, we sample medical costs for each (non-death) health state from
gamma distributions and they a stored in a <code>data.table</code> (one
row for each sample and one column for each health state). Likewise, the
parameters of each cell in the transition probability matrix are store
in a <code>data.table</code>, with parameters of the
<code>data.table</code> ordered rowwise across the columns. On the other
hand, samples of the relative risk are stored in a vector.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rng_def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_rng.html">define_rng</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">lrr_se</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">lrr_upper</span> <span class="op">-</span> <span class="va">lrr_lower</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">.975</span><span class="op">)</span><span class="op">)</span> <span class="co"># Local object </span></span>
<span>                                                      <span class="co"># not returned</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="co"># Parameters to return</span></span>
<span>    p_mono <span class="op">=</span> <span class="fu"><a href="../reference/rng_distributions.html">dirichlet_rng</a></span><span class="op">(</span><span class="va">alpha_mono</span><span class="op">)</span>,</span>
<span>    rr_comb <span class="op">=</span> <span class="fu"><a href="../reference/rng_distributions.html">lognormal_rng</a></span><span class="op">(</span><span class="va">lrr_mean</span>, <span class="va">lrr_se</span><span class="op">)</span>,</span>
<span>    c_zido <span class="op">=</span> <span class="va">c_zido</span>,</span>
<span>    c_lam <span class="op">=</span> <span class="va">c_lam</span>,</span>
<span>    c_dmed <span class="op">=</span> <span class="fu"><a href="../reference/rng_distributions.html">gamma_rng</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">c_dmed_mean</span>, sd <span class="op">=</span> <span class="va">c_dmed_mean</span><span class="op">)</span>,</span>
<span>    c_cmed <span class="op">=</span> <span class="fu"><a href="../reference/rng_distributions.html">gamma_rng</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">c_cmed_mean</span>, sd <span class="op">=</span> <span class="va">c_cmed_mean</span><span class="op">)</span>,</span>
<span>    u <span class="op">=</span> <span class="va">u</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span>, n <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="transformed-parameters">Transformed parameters<a class="anchor" aria-label="anchor" href="#transformed-parameters"></a>
</h3>
<p>In most statistical models, the underlying parameters are
“transformed” into more relevant parameters for prediction. For
instance, if a multinomial logistic regression is used parameterize
transition probabilities, the coefficients are used to predict the
probabilities. While transition, cost, and utility models can be
parameterized using supported statistical models with
<code><a href="../reference/params.html">hesim::params</a></code> objects, they can also, in some cases, be
parameterized using the transformed parameters themselves with
<code><a href="../reference/tparams.html">hesim::tparams</a></code> objects.</p>
<p>We will use the transformed parameter approach here by using
<code><a href="../reference/define_tparams.html">define_tparams()</a></code> to define <code>tparams</code> objects as
a function of the underlying parameters and input data (treatment
strategies and patients). We generate the input data using
<code><a href="../reference/expand.html">hesim::expand()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expand.html">expand</a></span><span class="op">(</span><span class="va">hesim_dat</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"strategies"</span>, <span class="st">"patients"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">input_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    strategy_id patient_id       strategy_name</span></span>
<span><span class="co">##          &lt;int&gt;      &lt;num&gt;              &lt;char&gt;</span></span>
<span><span class="co">## 1:           1          1         Monotherapy</span></span>
<span><span class="co">## 2:           2          1 Combination therapy</span></span></code></pre>
<p>Operations in a <code><a href="../reference/define_tparams.html">define_tparams()</a></code> block are performed
using the columns from the input data and a list of parameters . To
maximize computational efficiency, all operations are vectorized across
the rows in the data and PSA samples. Parameters not included in a
transformed parameter function are assumed constant across patients and
treatment strategies. A list must be returned with elements for the
transition probability matrix, costs, and utilities.</p>
<p>An important helper function is <code><a href="../reference/tpmatrix.html">tpmatrix()</a></code>, which allows
users to define transition matrices as a function of other parameters.
In this example, transition probabilities are defined in terms of the
transition matrix for monotherapy (<code>p_mono</code>) and the relative
risk (<code>rr</code>). The relative risk is simply 1 for monotherapy
(since the corresponding transition matrix is just <code>p_mono</code>)
and equal to <code>rr_comb</code> for combination therapy.</p>
<p>The only costs in the model that vary across treatment strategies
(rather than just states) are drug costs. The monotherapy treatment
strategy include the cost of zidovudine only whereas the combination
therapy includes the costs of both zidovudine and lamivudine.</p>
<p>Parameters may depend on time (since the start of the model) by using
the package defined <code>time</code> variable. The <code>time</code>
variable corresponds to the stopping time of time intervals, which are
specified using the <code>times</code> argument in
<code><a href="../reference/define_tparams.html">define_tparams()</a></code>. Since patients are only assumed to use
lamivudine for two years, <code>rr_comb</code> and the costs of
lamivudine are not applied beyond year 2.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tparams_def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_tparams.html">define_tparams</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="co">## The treatment effect (relative risk) is transformed so that it varies by </span></span>
<span>  <span class="co">## strategies and only applies for the first 2 years (Monotherapy is </span></span>
<span>  <span class="co">## the reference strategy). </span></span>
<span>  <span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">strategy_name</span> <span class="op">==</span> <span class="st">"Monotherapy"</span> <span class="op">|</span> <span class="va">time</span> <span class="op">&gt;</span> <span class="fl">2</span>, <span class="fl">1</span>, <span class="va">rr_comb</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    tpmatrix <span class="op">=</span> <span class="fu"><a href="../reference/tpmatrix.html">tpmatrix</a></span><span class="op">(</span></span>
<span>      <span class="va">C</span>, <span class="va">p_mono</span><span class="op">$</span><span class="va">A_B</span> <span class="op">*</span> <span class="va">rr</span>, <span class="va">p_mono</span><span class="op">$</span><span class="va">A_C</span> <span class="op">*</span> <span class="va">rr</span>, <span class="va">p_mono</span><span class="op">$</span><span class="va">A_D</span> <span class="op">*</span> <span class="va">rr</span>,</span>
<span>      <span class="fl">0</span>, <span class="va">C</span>,               <span class="va">p_mono</span><span class="op">$</span><span class="va">B_C</span> <span class="op">*</span> <span class="va">rr</span>, <span class="va">p_mono</span><span class="op">$</span><span class="va">B_D</span> <span class="op">*</span> <span class="va">rr</span>,</span>
<span>      <span class="fl">0</span>, <span class="fl">0</span>,               <span class="va">C</span>,               <span class="va">p_mono</span><span class="op">$</span><span class="va">C_D</span> <span class="op">*</span> <span class="va">rr</span>,</span>
<span>      <span class="fl">0</span>, <span class="fl">0</span>,               <span class="fl">0</span>,               <span class="fl">1</span></span>
<span>    <span class="op">)</span>,</span>
<span>    utility <span class="op">=</span> <span class="va">u</span>,</span>
<span>    costs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        drug <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">strategy_name</span> <span class="op">==</span> <span class="st">"Monotherapy"</span> <span class="op">|</span> <span class="va">time</span> <span class="op">&gt;</span> <span class="fl">2</span>,</span>
<span>                      <span class="va">c_zido</span>, <span class="va">c_zido</span> <span class="op">+</span> <span class="va">c_lam</span><span class="op">)</span>,</span>
<span>        community_medical <span class="op">=</span> <span class="va">c_cmed</span>,</span>
<span>        direct_medical <span class="op">=</span> <span class="va">c_dmed</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h2>
<div class="section level3">
<h3 id="constructing-the-economic-model">Constructing the economic model<a class="anchor" aria-label="anchor" href="#constructing-the-economic-model"></a>
</h3>
<p>The economic model is defined by using <code><a href="../reference/define_model.html">define_model()</a></code> to
combine the underlying parameters with the expressions for random number
generation and parameter transformation.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_model.html">define_model</a></span><span class="op">(</span>tparams_def <span class="op">=</span> <span class="va">tparams_def</span>, </span>
<span>                        rng_def <span class="op">=</span> <span class="va">rng_def</span>, </span>
<span>                        params <span class="op">=</span> <span class="va">params</span><span class="op">)</span></span></code></pre></div>
<p>A economic model (of class <code>CohortDtstm</code>) can be created
from the defined model and input data using the generic function
<code><a href="../reference/create_CohortDtstm.html">create_CohortDtstm()</a></code>. The economic model is an
<code>R6</code> object consisting of a transition model
(<code>trans_model</code>) for simulating transition probabilities with
<code><a href="../reference/sim_stateprobs.html">sim_stateprobs()</a></code>, a utility model for simulating
quality-adjusted life-years with <code><a href="../reference/sim_ev.html">sim_qalys()</a></code>, and a set of
cost models (for each cost category) for simulating costs with
<code><a href="../reference/sim_ev.html">sim_costs()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">econmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_CohortDtstm.html">create_CohortDtstm</a></span><span class="op">(</span><span class="va">mod_def</span>, <span class="va">input_data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simulating-outcomes">Simulating outcomes<a class="anchor" aria-label="anchor" href="#simulating-outcomes"></a>
</h3>
<div class="section level4">
<h4 id="health-state-probabilities">Health state probabilities<a class="anchor" aria-label="anchor" href="#health-state-probabilities"></a>
</h4>
<p>At the start of the model, all patients are assumed to be in State A
(the default setting of the transition model of class
<code>CohortDtstmTrans</code>). State occupancy probabilities are
generated by simulating the discrete time Markov chain.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">econmod</span><span class="op">$</span><span class="fu">sim_stateprobs</span><span class="op">(</span>n_cycles <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">econmod</span><span class="op">$</span><span class="va">stateprobs_</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    sample strategy_id patient_id grp_id state_id     t      prob</span></span>
<span><span class="co">##     &lt;num&gt;       &lt;int&gt;      &lt;int&gt;  &lt;int&gt;    &lt;num&gt; &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">## 1:      1           1          1      1        1     0 1.0000000</span></span>
<span><span class="co">## 2:      1           1          1      1        1     1 0.7100136</span></span>
<span><span class="co">## 3:      1           1          1      1        1     2 0.5041193</span></span>
<span><span class="co">## 4:      1           1          1      1        1     3 0.3579315</span></span>
<span><span class="co">## 5:      1           1          1      1        1     4 0.2541362</span></span>
<span><span class="co">## 6:      1           1          1      1        1     5 0.1804402</span></span></code></pre>
<p>A plot can be generated quickly using the
<code><a href="../reference/autoplot.stateprobs.html">autoplot.stateprobs()</a></code> method. As expected, patients survive
longer with combination therapy.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">econmod</span><span class="op">$</span><span class="va">stateprobs_</span>, labels <span class="op">=</span> <span class="va">labs</span>,</span>
<span>         ci <span class="op">=</span> <span class="cn">TRUE</span>, ci_style <span class="op">=</span> <span class="st">"ribbon"</span><span class="op">)</span></span></code></pre></div>
<p><img src="markov-cohort_files/figure-html/simStateprobsPlot-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="costs-and-qalys">Costs and QALYs<a class="anchor" aria-label="anchor" href="#costs-and-qalys"></a>
</h4>
<p>Costs and quality-adjusted life-years (QALYs) are computed by
integrating the previously simulated state probabilities. To maintain
consistency with Chancellor et al., we approximate the integral with a
right Riemann sum, which is simply a sum of costs and QALYs measured at
the right endpoint of each interval (e.g., costs during model cycle 1
are measured at time 1 (rather than at say, time 0).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">econmod</span><span class="op">$</span><span class="fu">sim_qalys</span><span class="op">(</span>dr <span class="op">=</span> <span class="fl">0</span>, integrate_method <span class="op">=</span> <span class="st">"riemann_right"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">econmod</span><span class="op">$</span><span class="va">qalys_</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    sample strategy_id patient_id grp_id state_id    dr    qalys      lys</span></span>
<span><span class="co">##     &lt;num&gt;       &lt;int&gt;      &lt;int&gt;  &lt;int&gt;    &lt;int&gt; &lt;num&gt;    &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">## 1:      1           1          1      1        1     0 2.445842 2.445842</span></span>
<span><span class="co">## 2:      1           1          1      1        2     0 1.675727 1.675727</span></span>
<span><span class="co">## 3:      1           1          1      1        3     0 3.520198 3.520198</span></span>
<span><span class="co">## 4:      1           2          1      1        1     0 3.472488 3.472488</span></span>
<span><span class="co">## 5:      1           2          1      1        2     0 1.724961 1.724961</span></span>
<span><span class="co">## 6:      1           2          1      1        3     0 3.511484 3.511484</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">econmod</span><span class="op">$</span><span class="fu">sim_costs</span><span class="op">(</span>dr <span class="op">=</span> <span class="fl">0.06</span>, integrate_method <span class="op">=</span> <span class="st">"riemann_right"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">econmod</span><span class="op">$</span><span class="va">costs_</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    sample strategy_id patient_id grp_id state_id    dr category    costs</span></span>
<span><span class="co">##     &lt;num&gt;       &lt;int&gt;      &lt;int&gt;  &lt;int&gt;    &lt;int&gt; &lt;num&gt;   &lt;char&gt;    &lt;num&gt;</span></span>
<span><span class="co">## 1:      1           1          1      1        1  0.06     drug 4595.761</span></span>
<span><span class="co">## 2:      1           1          1      1        2  0.06     drug 2920.903</span></span>
<span><span class="co">## 3:      1           1          1      1        3  0.06     drug 5213.823</span></span>
<span><span class="co">## 4:      1           2          1      1        1  0.06     drug 9580.295</span></span>
<span><span class="co">## 5:      1           2          1      1        2  0.06     drug 3317.521</span></span>
<span><span class="co">## 6:      1           2          1      1        3  0.06     drug 5105.097</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="decision-analysis">Decision analysis<a class="anchor" aria-label="anchor" href="#decision-analysis"></a>
</h2>
<p>A decision analysis is performed by comparing combination therapy to
monotherapy.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ce_sim</span> <span class="op">&lt;-</span> <span class="va">econmod</span><span class="op">$</span><span class="fu">summarize</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">wtp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25000</span>, <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">cea_pw_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cea.html">cea_pw</a></span><span class="op">(</span><span class="va">ce_sim</span>, comparator <span class="op">=</span> <span class="fl">1</span>, dr_qalys <span class="op">=</span> <span class="fl">0</span>, dr_costs <span class="op">=</span> <span class="fl">.06</span>,</span>
<span>                     k <span class="op">=</span> <span class="va">wtp</span><span class="op">)</span></span></code></pre></div>
<p>The incremental cost-effectiveness ratio (ICER) estimated using means
from the PSA is very close to the estimate from the deterministic
analysis from Chancellor et al. </p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="../reference/icer.html">icer</a></span><span class="op">(</span><span class="va">cea_pw_out</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              Outcome                       2</span></span>
<span><span class="co">##               &lt;fctr&gt;                  &lt;char&gt;</span></span>
<span><span class="co">## 1: Incremental QALYs       0.93 (0.55, 1.22)</span></span>
<span><span class="co">## 2: Incremental costs    5,830 (2,635, 9,780)</span></span>
<span><span class="co">## 3:   Incremental NMB 40,481 (22,545, 55,126)</span></span>
<span><span class="co">## 4:              ICER                   6,295</span></span></code></pre>
<p>A cost-effectiveness acceptability curve shows that the probability
that combination therapy is more cost-effective than monotherapy
increases quickly with the willingness to pay (WTP) for a QALY. At
$10,000, the probability is 0.949 and approaches 1 at slightly higher
WTP values.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_ceac.html">plot_ceac</a></span><span class="op">(</span><span class="va">cea_pw_out</span>, labels <span class="op">=</span> <span class="va">labs</span><span class="op">)</span></span></code></pre></div>
<p><img src="markov-cohort_files/figure-html/ceac-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="appendix-dirichlet-distribution">Appendix: Dirichlet distribution<a class="anchor" aria-label="anchor" href="#appendix-dirichlet-distribution"></a>
</h2>
<p>The multinomial distribution is a discrete probability distribution
for the number of successes for each of k mutually exclusive categories
in n trials. The probabilities of the categories are given by <span class="math inline">\(\pi_1,\ldots, \pi_k\)</span> with <span class="math inline">\(\sum_{j=1}^k \pi_j=1\)</span> and each <span class="math inline">\(\pi_j\)</span> defined on <span class="math inline">\([0,1]\)</span>. The Dirichlet distribution is
parameterized by the concentration parameters <span class="math inline">\(\alpha_1,\ldots, \alpha_k\)</span> with <span class="math inline">\(\alpha_j &gt; 0\)</span>. Letting <span class="math inline">\(x_1,\ldots, x_k\)</span> denote the number of
successes in each category, the prior distribution and likelihood
are,</p>
<p><span class="math display">\[
\begin{aligned}
p(\pi_1,\ldots,\pi_k |\alpha_1,\ldots, \alpha_k) =
\text{Dirichlet}(\alpha_1,\ldots,\alpha_k) \\
p(x_1,\ldots,x_k | \pi_1,\ldots,\pi_k) = \text{Multin}(n,
\pi_1,\ldots,\pi_k).
\end{aligned}
\]</span></p>
<p>The posterior distribution for <span class="math inline">\(\pi_1,\ldots,\pi_k\)</span> is then given by,</p>
<p><span class="math display">\[
p\left(\pi_1,\ldots,\pi_k| x_1,\ldots,x_k, \alpha_1,\ldots,\alpha_k
\right) = \text{Dirichlet}\left(\alpha_1 + x_1, \ldots, \alpha_k +
x_k\right).
\]</span></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Devin Incerti, Jeroen P. Jansen, Mark Clements.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
